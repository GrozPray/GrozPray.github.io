<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GrozPray - –í—Ä–µ–º—è –Ω–∞–º–∞–∑–∞ –≤ –ì—Ä–æ–∑–Ω–æ–º</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Amiri:wght@700&family=Open+Sans:wght@400;600&display=swap">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/index.css">
</head>
<body>
    <div class="container">
        <header>
                <h1>GrozPray</h1>
            </div>
        </header>
        
        <nav>
            <a href="index.html" class="active">üïã –ù–∞–º–∞–∑</a>
            <a href="quran.html">üìñ –ö–æ—Ä–∞–Ω</a>
            <a href="dhikr.html">üìø –ó–∏–∫—Ä—ã</a>
        </nav>

        <main>
            <section class="card">
                <h2>‚è≥ –í—Ä–µ–º—è –Ω–∞–º–∞–∑–∞ - –ì—Ä–æ–∑–Ω—ã–π</h2>
                <div class="prayer-grid">
                    <div class="prayer-item" id="fajr-card">
                        <span class="prayer-name">–§–∞–¥–∂—Ä</span>
                        <span class="prayer-time" id="fajr">--:--</span>
                    </div>
                    <div class="prayer-item" id="dhuhr-card">
                        <span class="prayer-name">–ó—É—Ö—Ä</span>
                        <span class="prayer-time" id="dhuhr">--:--</span>
                    </div>
                    <div class="prayer-item" id="asr-card">
                        <span class="prayer-name">–ê—Å—Ä</span>
                        <span class="prayer-time" id="asr">--:--</span>
                    </div>
                    <div class="prayer-item" id="maghrib-card">
                        <span class="prayer-name">–ú–∞–≥—Ä–∏–±</span>
                        <span class="prayer-time" id="maghrib">--:--</span>
                    </div>
                    <div class="prayer-item" id="isha-card">
                        <span class="prayer-name">–ò—à–∞</span>
                        <span class="prayer-time" id="isha">--:--</span>
                    </div>
                </div>
            </section>
        </main>

        <footer>
            <p>¬© 2024 GrozPray | –°–¥–µ–ª–∞–Ω–æ –¥–ª—è –º—É—Å—É–ª—å–º–∞–Ω</p>
        </footer>
    </div>

    <script>
        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞–º–∞–∑–∞
        fetch('https://api.aladhan.com/v1/timingsByCity?city=Grozny&country=Russia&method=2')
            .then(response => response.json())
            .then(data => {
                const timings = data.data.timings;
                document.getElementById('fajr').textContent = timings.Fajr;
                document.getElementById('dhuhr').textContent = timings.Dhuhr;
                document.getElementById('asr').textContent = timings.Asr;
                document.getElementById('maghrib').textContent = timings.Maghrib;
                document.getElementById('isha').textContent = timings.Isha;
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Ä–µ–º—è –Ω–∞–º–∞–∑–æ–≤ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
                window.prayerTimes = {
                    fajr: timings.Fajr,
                    dhuhr: timings.Dhuhr,
                    asr: timings.Asr,
                    maghrib: timings.Maghrib,
                    isha: timings.Isha
                };
                
                checkCurrentPrayer(); // –ü–µ—Ä–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
                setInterval(checkCurrentPrayer, 30000); // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫
            });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –≤ –º–∏–Ω—É—Ç—ã
        function timeToMinutes(timeStr) {
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours * 60 + minutes;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –Ω–∞–º–∞–∑–∞
        function checkCurrentPrayer() {
            const now = new Date();
            const currentHours = now.getHours();
            const currentMinutes = now.getMinutes();
            const currentTimeInMinutes = currentHours * 60 + currentMinutes;
            
            // –ü–æ–ª—É—á–∞–µ–º –≤—Ä–µ–º—è –Ω–∞–º–∞–∑–æ–≤ –≤ –º–∏–Ω—É—Ç–∞—Ö
            const prayerTimesInMinutes = {};
            for (const [prayer, time] of Object.entries(window.prayerTimes)) {
                prayerTimesInMinutes[prayer] = timeToMinutes(time);
            }
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ—Ä—è–¥–æ–∫ –Ω–∞–º–∞–∑–æ–≤
            const prayerOrder = ['fajr', 'dhuhr', 'asr', 'maghrib', 'isha'];
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ –ø–æ–¥—Å–≤–µ—Ç–∫–∏
            document.querySelectorAll('.prayer-item').forEach(item => {
                item.classList.remove('current-prayer');
            });
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –Ω–∞–º–∞–∑
            let currentPrayer = null;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ–º–µ–∂—É—Ç–∫–∏ –º–µ–∂–¥—É –Ω–∞–º–∞–∑–∞–º–∏
            for (let i = 0; i < prayerOrder.length; i++) {
                const current = prayerOrder[i];
                const next = prayerOrder[(i + 1) % prayerOrder.length];
                
                // –î–ª—è –ò—à–∞ —É—á–∏—Ç—ã–≤–∞–µ–º, —á—Ç–æ —Å–ª–µ–¥—É—é—â–∏–π –Ω–∞–º–∞–∑ - –§–∞–¥–∂—Ä —Å–ª–µ–¥—É—é—â–µ–≥–æ –¥–Ω—è
                if (current === 'isha') {
                    if (currentTimeInMinutes >= prayerTimesInMinutes['isha'] || 
                        currentTimeInMinutes < prayerTimesInMinutes['fajr']) {
                        currentPrayer = 'isha';
                        break;
                    }
                } else {
                    if (currentTimeInMinutes >= prayerTimesInMinutes[current] && 
                        currentTimeInMinutes < prayerTimesInMinutes[next]) {
                        currentPrayer = current;
                        break;
                    }
                }
            }
            
            // –ï—Å–ª–∏ –Ω–∞—à–ª–∏ —Ç–µ–∫—É—â–∏–π –Ω–∞–º–∞–∑ - –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –µ–≥–æ
            if (currentPrayer) {
                document.getElementById(`${currentPrayer}-card`).classList.add('current-prayer');
                console.log(`–¢–µ–∫—É—â–∏–π –Ω–∞–º–∞–∑: ${currentPrayer}`);
            }
        }

        // –ó–∞–ø—Ä–æ—Å–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        Notification.requestPermission().then(permission => {
            if (permission !== "granted") {
                console.log("–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º");
                return;
            }

            // –ü–æ–ª—É—á–∏—Ç—å –≤—Ä–µ–º—è –Ω–∞–º–∞–∑–∞ –¥–ª—è –ì—Ä–æ–∑–Ω–æ–≥–æ
            fetch("https://api.aladhan.com/v1/timingsByCity?city=Grozny&country=Russia&method=2")
                .then(response => response.json())
                .then(data => {
                    const timings = data.data.timings;
                    
                    // –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–∞–º–∞–∑–∞
                    Object.entries(timings).forEach(([prayerName, prayerTime]) => {
                        if (['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'].includes(prayerName)) {
                            scheduleNotification(prayerName, prayerTime);
                        }
                    });
                })
                .catch(error => {
                    console.error("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –≤—Ä–µ–º—è –Ω–∞–º–∞–∑–∞:", error);
                });
        });

        function scheduleNotification(prayerName, prayerTime) {
            const now = new Date();
            const prayerDate = new Date(now);
            const [hours, minutes] = prayerTime.split(':');
            
            prayerDate.setHours(parseInt(hours, 10));
            prayerDate.setMinutes(parseInt(minutes, 10));
            prayerDate.setSeconds(0);
            
            // –ï—Å–ª–∏ –≤—Ä–µ–º—è –Ω–∞–º–∞–∑–∞ —É–∂–µ –ø—Ä–æ—à–ª–æ —Å–µ–≥–æ–¥–Ω—è, –ø–ª–∞–Ω–∏—Ä—É–µ–º –Ω–∞ –∑–∞–≤—Ç—Ä–∞
            if (prayerDate < now) {
                prayerDate.setDate(prayerDate.getDate() + 1);
            }
            
            const delay = prayerDate - now;
            
            setTimeout(() => {
                const prayerNames = {
                    'Fajr': '–§–∞–¥–∂—Ä',
                    'Dhuhr': '–ó—É—Ö—Ä',
                    'Asr': '–ê—Å—Ä',
                    'Maghrib': '–ú–∞–≥—Ä–∏–±',
                    'Isha': '–ò—à–∞'
                };
                
                new Notification("–í—Ä–µ–º—è –Ω–∞–º–∞–∑–∞!", {
                    body: `–°–µ–π—á–∞—Å –≤—Ä–µ–º—è ${prayerNames[prayerName]}: ${prayerTime}. –ü–æ—Ä–∞ —Å–æ–≤–µ—Ä—à–∏—Ç—å –Ω–∞–º–∞–∑ üôè`,
                    icon: "images/logo.png"
                });
                
                // –ü–ª–∞–Ω–∏—Ä—É–µ–º —Å–ª–µ–¥—É—é—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–∞ –∑–∞–≤—Ç—Ä–∞
                scheduleNotification(prayerName, prayerTime);
            }, delay);
        }
    </script>
</body>
</html>
