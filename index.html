<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GrozPray - –í—Ä–µ–º—è –Ω–∞–º–∞–∑–∞ –≤ –ì—Ä–æ–∑–Ω–æ–º</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Amiri:wght@700&family=Open+Sans:wght@400;600&display=swap">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/index.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>GrozPray</h1>
            <p class="slogan">–í–∞—à –ø–æ–º–æ—â–Ω–∏–∫ –≤ –ø–æ–∫–ª–æ–Ω–µ–Ω–∏–∏</p>
        </header>
        
        <nav>
            <a href="index.html" class="active">üïã –ù–∞–º–∞–∑</a>
            <a href="quran.html">üìñ –ö–æ—Ä–∞–Ω</a>
            <a href="dhikr.html">üìø –ó–∏–∫—Ä—ã</a>
        </nav>

        <main>
            <section class="card">
                <h2>‚è≥ –í—Ä–µ–º—è –Ω–∞–º–∞–∑–∞ - –ì—Ä–æ–∑–Ω—ã–π</h2>
                <div class="prayer-grid">
                    <div class="prayer-item" id="fajr-card">
                        <span class="prayer-name">–§–∞–¥–∂—Ä</span>
                        <span class="prayer-time" id="fajr">--:--</span>
                    </div>
                    <div class="prayer-item" id="dhuhr-card">
                        <span class="prayer-name">–ó—É—Ö—Ä</span>
                        <span class="prayer-time" id="dhuhr">--:--</span>
                    </div>
                    <div class="prayer-item" id="asr-card">
                        <span class="prayer-name">–ê—Å—Ä</span>
                        <span class="prayer-time" id="asr">--:--</span>
                    </div>
                    <div class="prayer-item" id="maghrib-card">
                        <span class="prayer-name">–ú–∞–≥—Ä–∏–±</span>
                        <span class="prayer-time" id="maghrib">--:--</span>
                    </div>
                    <div class="prayer-item" id="isha-card">
                        <span class="prayer-name">–ò—à–∞</span>
                        <span class="prayer-time" id="isha">--:--</span>
                    </div>
                </div>
            </section>
        </main>

        <footer>
            <p>¬© 2024 GrozPray | –°–¥–µ–ª–∞–Ω–æ –¥–ª—è –º—É—Å—É–ª—å–º–∞–Ω</p>
        </footer>
    </div>

    <script>
        // 1. –ó–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            if (!("Notification" in window)) {
                console.log("–ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è");
            } else if (Notification.permission !== "denied") {
                Notification.requestPermission();
            }
        });

        // 2. –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞–º–∞–∑–∞
        function loadPrayerTimes() {
            fetch('https://api.aladhan.com/v1/timingsByCity?city=Grozny&country=Russia&method=2')
                .then(response => response.json())
                .then(data => {
                    const timings = data.data.timings;
                    
                    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤—Ä–µ–º—è
                    document.getElementById('fajr').textContent = timings.Fajr;
                    document.getElementById('dhuhr').textContent = timings.Dhuhr;
                    document.getElementById('asr').textContent = timings.Asr;
                    document.getElementById('maghrib').textContent = timings.Maghrib;
                    document.getElementById('isha').textContent = timings.Isha;
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –ø—Ä–æ–≤–µ—Ä–æ–∫
                    window.prayerTimes = timings;
                    
                    // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫–∏
                    checkCurrentPrayer();
                    setupNotifications();
                });
        }

        // 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –Ω–∞–º–∞–∑–∞
        function checkCurrentPrayer() {
            if (!window.prayerTimes) return;
            
            const now = new Date();
            const currentTime = now.getHours() * 60 + now.getMinutes();
            
            // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤—Å–µ –≤—Ä–µ–º–µ–Ω–∞ –≤ –º–∏–Ω—É—Ç—ã
            const times = {
                fajr: convertToMinutes(window.prayerTimes.Fajr),
                dhuhr: convertToMinutes(window.prayerTimes.Dhuhr),
                asr: convertToMinutes(window.prayerTimes.Asr),
                maghrib: convertToMinutes(window.prayerTimes.Maghrib),
                isha: convertToMinutes(window.prayerTimes.Isha)
            };
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É
            document.querySelectorAll('.prayer-item').forEach(el => {
                el.classList.remove('current-prayer');
            });
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–π –ø–µ—Ä–∏–æ–¥
            if (currentTime >= times.isha || currentTime < times.fajr) {
                document.getElementById('isha-card').classList.add('current-prayer');
            } 
            else if (currentTime >= times.maghrib) {
                document.getElementById('maghrib-card').classList.add('current-prayer');
            }
            else if (currentTime >= times.asr) {
                document.getElementById('asr-card').classList.add('current-prayer');
            }
            else if (currentTime >= times.dhuhr) {
                document.getElementById('dhuhr-card').classList.add('current-prayer');
            }
            else if (currentTime >= times.fajr) {
                document.getElementById('fajr-card').classList.add('current-prayer');
            }
        }

        // 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function setupNotifications() {
            setInterval(() => {
                const now = new Date();
                const currentTime = formatTime(now.getHours(), now.getMinutes());
                
                if (window.prayerTimes.Fajr === currentTime) sendNotification('–§–∞–¥–∂—Ä');
                if (window.prayerTimes.Dhuhr === currentTime) sendNotification('–ó—É—Ö—Ä');
                if (window.prayerTimes.Asr === currentTime) sendNotification('–ê—Å—Ä');
                if (window.prayerTimes.Maghrib === currentTime) sendNotification('–ú–∞–≥—Ä–∏–±');
                if (window.prayerTimes.Isha === currentTime) sendNotification('–ò—à–∞');
            }, 60000);
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function convertToMinutes(timeStr) {
            const [h, m] = timeStr.split(':');
            return parseInt(h) * 60 + parseInt(m);
        }
        
        function formatTime(h, m) {
            return `${h}:${m < 10 ? '0'+m : m}`;
        }
        
        function sendNotification(prayerName) {
            if (Notification.permission === "granted") {
                new Notification(`–í—Ä–µ–º—è –Ω–∞–º–∞–∑–∞ ${prayerName}`, {
                    body: `–ù–∞—Å—Ç—É–ø–∏–ª–æ –≤—Ä–µ–º—è ${prayerName}. –ü–æ—Ä–∞ —Å–æ–≤–µ—Ä—à–∏—Ç—å –Ω–∞–º–∞–∑!`,
                    icon: 'images/logo.png'
                });
            }
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        loadPrayerTimes();
        setInterval(checkCurrentPrayer, 60000);
    </script>
</body>
</html>
